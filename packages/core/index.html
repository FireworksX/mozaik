<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Time travel</title>
  </head>
  <body>
    <div id="app">
      <h1>{{ userStore.name }}</h1>
    </div>

    <script src="build/mozaikjs.umd.js"></script>
    <script>
      const { types, onSnapshot } = core

      const deepModel = types
        .model('deep', {
          a: types.string
        })
        .actions({
          set({ dispatch, env }, a) {
            console.log(env);
            dispatch({ a })
          }
        })

      const userStoreModel = types
        .model('user', {
          name: types.maybe(types.string),
          deep: deepModel
        })
        .actions({
          setName({ dispatch, env }, name) {
            dispatch({
              name
            })
          }
        })

      const userStoreInstance = userStoreModel.create({
        name: 'arthur',
        deep: deepModel.create({
          a: 'aaa'
        })
      })

      const rootStoreModel = types
        .model('rootStore', {
          msg: types.string,
          list: types.array(types.string),
          userStore: userStoreModel
        })
        .actions({
          inputText({ dispatch }, value) {
            dispatch({
              msg: value
            })
          },
          addTodo({ dispatch, state }) {
            dispatch({
              list: [...state.list, state.msg]
            })
          }
        })
        .create(
          {
            msg: 'arthur',
            list: [],
            userStore: userStoreInstance
          },
          {
            api: 1,
            userStore: userStoreInstance
          }
        )

      const newState = rootStoreModel

      onSnapshot(rootStoreModel, state => {
        Object.keys(state).forEach(key => {
          newState[key] = state[key]
        })
      })

      rootStoreModel.userStore.setName('esfs')
      rootStoreModel.userStore.deep.set('a2')

      console.log(rootStoreModel)
    </script>
  </body>
</html>
