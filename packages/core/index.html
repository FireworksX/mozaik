<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Time travel</title>
  </head>
  <body>
    <div id="app">
      <h1>{{ userStore.name }}</h1>
    </div>
    <script src="build/mozaikjs.umd.js"></script>
    <script>
      const types = core.types

      const fetcherModel = types
        .model('fetcher', {
          isLoading: types.boolean,
          error: types.maybe(types.any)
        })
        .actions({
          async wrapPromise({ dispatch }, promise) {
            dispatch({ isLoading: true, error: undefined })

            try {
              const data = await promise

              dispatch({ isLoading: false })
              return data
            } catch (e) {
              dispatch({ isLoading: false, error: e })
            }
          }
        })
        .computed({
          hasError({ state }) {
            return state().error !== undefined
          }
        })
        .subscribe(console.log)

      const userStore = types.model('user', {}).compose(fetcherModel).create({
        isLoading: false
      })

      console.log(userStore)

    </script>
  </body>
</html>
